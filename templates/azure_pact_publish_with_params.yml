parameters:
  - name: pactfiles # "Location of the Pact files"
    default: false 
  - name: broker_url # "The url of your pact broker"
    default: ""
  - name: token # description: "Your pact broker token (required for PactFlow)"
    default: ""
  - name: username # description: "Your pact broker username"
    default: ""
  - name: password # description: "Your pact broker password"
    default: ""
  - name: version # description: "Version to publish"
    default: ""
  - name: branch # description: "branch to associate version of pact with"  
    default: ""
  - name: tag # description: "tag to associate version of pact with"
    default: ""
  - name: tag_with_git_branch # description: "tag pact with git branch"
    default: ""
  - name: build_url # description: "uri to the pipeline build"
    default: ""

steps:
- script: |
    ./templates/scripts/publishPactFiles.sh
  displayName: ✉️  Publish Pacts
  env:
    PACT_BROKER_BASE_URL: ${{ coalesce(parameters.broker_url, variables.PACT_BROKER_BASE_URL) }}
    PACT_BROKER_TOKEN: ${{ coalesce(parameters.token, variables.PACT_BROKER_TOKEN) }}
    PACT_BROKER_USERNAME: ${{ coalesce(parameters.username, variables.PACT_BROKER_USERNAME) }}
    PACT_BROKER_PASSWORD: ${{ coalesce(parameters.password, variables.PACT_BROKER_PASSWORD) }}
    COMMIT: ${{ coalesce(parameters.version, variables.COMMIT) }}
    BRANCH: ${{ coalesce(parameters.branch, variables.BRANCH) }}
    BUILD_URI: ${{ coalesce(parameters.build_url, variables.BUILD_URI) }}
    pactfiles: ${{ parameters.pactfiles }}
    tag: ${{ coalesce(parameters.tag, variables.tag) }}
    tag_with_git_branch: ${{ parameters.tag_with_git_branch }}

    