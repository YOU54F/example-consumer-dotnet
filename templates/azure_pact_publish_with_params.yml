parameters:
  - name: broker_url
    # description: "The url of your pact broker"
    # required: true
  - name: pactfiles
    # description: "Location of the Pact files"
    # required: true
  - name: token
    # description: "Your pact broker token (required for PactFlow)"
    default: ""
  - name: username
    default: ""
    # description: "Your pact broker username"
  - name: password
    default: ""
    # description: "Your pact broker password"
  - name: version
    default: ""
    # description: "Version to publish"
  - name: branch
    default: ""
    # description: "branch to associate version of pact with"  
  - name: tag
    default: ""
    # description: "tag to associate version of pact with"
  - name: tag_with_git_branch
    default: ""
    # description: "tag pact with git branch"
  - name: build_uri
    default: ""
    # description: "uri to the pipeline build"

# variables:
#   BRANCH: $[replace(variables['Build.SourceBranch'], 'refs/heads/', '')]
#   COMMIT: $(Build.SourceVersion)
#   BUILD_URI: '$(System.CollectionUri)$(System.TeamProject)/_build/results?buildId=$(Build.BuildId)'

steps:
- script: |
    printenv
    ./templates/publishPactFiles.sh
  displayName: ✉️  Publish Pacts
  env:
    # PACT_BROKER_TOKEN: $(PACT_BROKER_TOKEN)
    # PACT_BROKER_BASE_URL: ${{ coalesce(parameters.broker_url, variables.PACT_BROKER_BASE_URL) }}
    # PACT_BROKER_TOKEN: ${{ coalesce(parameters.token, variables.PACT_BROKER_TOKEN) }}
    # PACT_BROKER_USERNAME: ${{ coalesce(parameters.username, variables.PACT_BROKER_USERNAME) }}
    # PACT_BROKER_PASSWORD: ${{ coalesce(parameters.password, variables.PACT_BROKER_PASSWORD) }}
    # pactfiles: ${{ parameters.pactfiles }}
    # version: ${{ coalesce(parameters.version, variables.COMMIT) }}
    # tag: ${{ coalesce(parameters.tag, variables.tag) }}
    # branch: ${{ coalesce(parameters.branch, variables.BRANCH) }}
    # tag_with_git_branch: ${{ parameters.tag_with_git_branch }}
    # build_uri: ${{ coalesce(parameters.build_uri, variables.BUILD_URI) }}

    