# TO TEST

# name: "delete-branch"
# description: "Deletes a pacticipant branch"

parameters:
  - name: broker_url # "The url of your pact broker"
    default: ""
  - name: token # "Your pact broker token (required for PactFlow)"
    default: ""
  - name: username # "Your pact broker username"
    default: ""
  - name: password # "Your pact broker password"
    default: ""
  - name: application_name # "The name of your application (usually project name)"
    default: false
  branch: # "The branch of your application to delete"
    default: false
  error_when_not_found: # "Raise an error if the branch that is to be deleted is not found"
    default: false
    type: boolean

steps:
- script: |
    ./templates/scripts/deleteBranch.sh
  displayName: Delete Branch
  env: 
    PACT_BROKER_BASE_URL: ${{ coalesce(parameters.broker_url, variables.PACT_BROKER_BASE_URL) }}
    PACT_BROKER_TOKEN: ${{ coalesce(parameters.token, variables.PACT_BROKER_TOKEN) }}
    PACT_BROKER_USERNAME: ${{ coalesce(parameters.username, variables.PACT_BROKER_USERNAME) }}
    PACT_BROKER_PASSWORD: ${{ coalesce(parameters.password, variables.PACT_BROKER_PASSWORD) }}
    application_name: ${{ coalesce(parameters.application_name , variables.application_name) }}
    COMMIT: ${{ coalesce(parameters.version, variables.COMMIT) }}
    BRANCH: ${{ coalesce(parameters.branch, variables.BRANCH) }}
    error_when_not_found: ${{ inputs.error_when_not_found || env.error_when_not_found }}
