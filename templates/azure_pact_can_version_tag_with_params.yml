# TO TEST

# name: "create-version-tag"
# description: "Creates a tag on the specified version"

parameters:
  - name: broker_url # "The url of your pact broker"
    default: ""
  - name: token # description: "Your pact broker token (required for PactFlow)"
    default: ""
  - name: username # description: "Your pact broker username"
    default: ""
  - name: password # description: "Your pact broker password"
    default: ""
  - name: application_name # "The name of your application (usually project name)"
    default: false
  - name: version # description: "Version to publish"
    default: ""
  - name: tag # description: "tag to associate version of pact with"
    default: ""
  - name: tag_with_git_branch # description: "tag pact with git branch"
    default: false
    type: boolean
  - name: auto_create_version # "Automatically create the pacticipant version if it does not exist"
    default: false
    type: boolean
steps:
- script: |
    ./templates/scripts/createTag.sh
  displayName: Create tag
  env:
    PACT_BROKER_BASE_URL: ${{ coalesce(parameters.broker_url, variables.PACT_BROKER_BASE_URL) }}
    PACT_BROKER_TOKEN: ${{ coalesce(parameters.token, variables.PACT_BROKER_TOKEN) }}
    PACT_BROKER_USERNAME: ${{ coalesce(parameters.username, variables.PACT_BROKER_USERNAME) }}
    PACT_BROKER_PASSWORD: ${{ coalesce(parameters.password, variables.PACT_BROKER_PASSWORD) }}
    application_name: ${{ coalesce(parameters.application_name , variables.application_name) }}
    COMMIT: ${{ coalesce(parameters.version, variables.COMMIT) }}
    tag: ${{ coalesce(parameters.tag, variables.tag) }}
    tag_with_git_branch: ${{ parameters.tag_with_git_branch }}
    auto_create_version: ${{ parameters.auto_create_version }}
